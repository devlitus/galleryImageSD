import"./hoisted.DYPaihtt.js";const d=a=>a.type.startsWith("image/"),u=a=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=()=>t(r.error),r.readAsDataURL(a)}),c=async a=>{const e=[];if(a.isFile){const t=await new Promise(r=>{a.file(r)});d(t)&&e.push(t)}else if(a.isDirectory){const t=a.createReader(),r=await new Promise(n=>{t.readEntries(n)});for(const n of r){const i=await c(n);e.push(...i)}}return e};class m{container;onUpdateImages;constructor(e,t){this.container=e,this.onUpdateImages=t}async addImage(e){try{const t=await u(e),r=this.createImageContainer(e,t);this.container.appendChild(r),this.onUpdateImages()}catch(t){console.error("Error adding image:",t)}}createImageContainer(e,t){const r=document.createElement("div");r.className="relative group";const n=document.createElement("img");n.src=t,n.className="w-full h-24 object-cover rounded-lg",n.originalFile=e;const i=this.createDeleteButton(r);return r.appendChild(n),r.appendChild(i),r}createDeleteButton(e){const t=document.createElement("button");return t.className="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",t.innerHTML="×",t.onclick=r=>{r.preventDefault(),e.remove(),this.onUpdateImages()},t}getImageUrls(){return Array.from(this.container.getElementsByTagName("img")).map(e=>e.src)}clear(){this.container.innerHTML="",this.onUpdateImages()}}class h{dropZone;fileInput;preview;submitButton;container;constructor(e,t,r,n){this.dropZone=document.getElementById(e),this.fileInput=document.getElementById(t),this.submitButton=document.getElementById(n);const i=document.getElementById(r);this.preview=new m(i,()=>this.updateSubmitButtonState()),this.container=i,this.initializeEventListeners(),this.updateSubmitButtonState(),this.updateSubmitButtonState()}initializeEventListeners(){this.dropZone.addEventListener("dragover",this.handleDragOver.bind(this)),this.dropZone.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.dropZone.addEventListener("drop",this.handleDrop.bind(this)),this.fileInput.addEventListener("change",this.handleFileInputChange.bind(this))}handleDragOver(e){e.preventDefault(),this.dropZone.classList.add("bg-gray-100","dark:bg-gray-700","border-gray-400","dark:border-gray-500")}handleDragLeave(){this.dropZone.classList.remove("bg-gray-100","dark:bg-gray-700","border-gray-400","dark:border-gray-500")}async handleDrop(e){e.preventDefault(),this.handleDragLeave();const t=e.dataTransfer?.items;if(t)for(const r of Array.from(t)){const n=r.webkitGetAsEntry();n&&(await c(n)).forEach(s=>this.preview.addImage(s))}else e.dataTransfer?.files&&Array.from(e.dataTransfer.files).filter(d).forEach(r=>this.preview.addImage(r));this.updateSubmitButtonState()}handleFileInputChange(){this.fileInput.files&&(Array.from(this.fileInput.files).filter(d).forEach(e=>this.preview.addImage(e)),this.updateSubmitButtonState())}updateSubmitButtonState(){const e=this.preview.getImageUrls().length>0;this.submitButton.disabled=!e}async fileToDataUrl(e){return new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)})}async handleSubmit(){try{this.submitButton.disabled=!0,this.submitButton.textContent="Subiendo...";const e=document.getElementById("preview");if(!e)return;const t=Array.from(e.getElementsByTagName("img")),r=t.map(async s=>{const l=s.originalFile;if(!l)return;const o=await fetch("/api/upload",{method:"POST",body:l});if(!o.ok)throw new Error(`Upload failed: ${o.statusText}`);return await o.json()}),i=(await Promise.all(r)).filter(Boolean).length;alert(`${i} de ${t.length} imágenes subidas exitosamente`),i>0&&this.preview.clear()}catch(e){console.error("Upload error:",e),alert("Error al subir las imágenes")}finally{this.submitButton.disabled=!1,this.submitButton.textContent="Subir imágenes"}}}const g=new h("dropZone","fileInput","preview","submitButton");document.getElementById("selectFiles")?.addEventListener("click",a=>{a.stopPropagation(),document.getElementById("fileInput")?.click()});document.getElementById("uploadForm")?.addEventListener("submit",async a=>{a.preventDefault(),await g.handleSubmit()});
